import"./data.js";import{products}from"./data.js";import"./utils.js";import{mobile}from"./utils.js";const counterText=document.querySelector(".header__icon-quantity-text"),cartButtons=document.querySelectorAll(".product-container__add-cart"),footer=document.querySelector(".footer"),main=document.querySelector(".main"),body=document.querySelector(".body"),header=document.querySelector(".header"),nav=document.querySelector(".header__navigation-lists"),cartContainer=document.querySelector(".header__icons-item--cart"),alertTemplate=document.querySelector("#added").content.querySelector(".added-alert"),cartTemplateEmpty=document.querySelector("#empty").content.querySelector(".cart-popup--empty"),cartTemplateFull=document.querySelector("#full").content.querySelector(".cart-popup--full"),productTemplate=document.querySelector("#product").content.querySelector(".cart-popup__product-card"),lockPaddingValue=window.innerWidth-main.offsetWidth;let cart,subtotalQuantity,subtotalSumProduct,counterValue,subtotalCart,pickedProducts=[];const BASIC_VALUE=0;counterValue=0,subtotalCart=0;const counterValueUp=()=>{counterValue++,counterText.textContent=counterValue},counterUpdate=t=>{counterValue=counterValue-products[t.target.name].quantity,counterText.textContent=0===counterValue?"":counterValue},onButtonClickAdd=t=>{counterValue++,counterText.textContent=counterValue,pickProducts(t),countProducts(t),calculateSubtotal(),renderAlert()},onContainerMouseEnter=()=>{renderCart()},onContainerMouseLeave=()=>{mobile()||closeCart()},onProductRemove=t=>{counterUpdate(t),cartUpdate(t),deleteProducts(t),reRenderCart()},lockScroll=()=>{mobile()||(main.style.paddingRight=`${lockPaddingValue}px`,footer.style.paddingRight=`${lockPaddingValue}px`,navigator.userAgent.includes("Chrome")&&(header.style.marginRight="-1px")),body.style.overflowY="hidden"},unlockScroll=()=>{mobile()||(main.style.paddingRight=0,footer.style.paddingRight=0,navigator.userAgent.includes("Chrome")&&(header.style.marginRight="auto")),nav.classList.contains("header__navigation-lists--opened")||(body.style.overflowY="auto")},closeCart=()=>{document.querySelector(".cart-popup").classList.add("cart-popup--fade-in"),setTimeout((()=>(mobile()||(main.style.paddingRight=0,footer.style.paddingRight=0,navigator.userAgent.includes("Chrome")&&(header.style.marginRight="auto")),void(nav.classList.contains("header__navigation-lists--opened")||(body.style.overflowY="auto")))),500),setTimeout((()=>cart.remove()),500)},deleteProducts=t=>{let e=pickedProducts.filter((e=>e!==t.target.name));pickedProducts=e},cartUpdate=t=>{products[t.target.name].quantity=0,calculateSubtotal(),cart.querySelector(".cart-popup__subtotal-sum").textContent=`${subtotalCart}$`},renderAlert=()=>{const t=alertTemplate.cloneNode(!0);main.append(t);document.querySelectorAll(".added-alert").forEach((t=>{t.classList.add("added-alert--fade-out"),setTimeout((()=>t.classList.add("added-alert--fade-in")),500)})),setTimeout((()=>t.remove()),2e3)},renderCart=()=>{mobile()||(main.style.paddingRight=`${lockPaddingValue}px`,footer.style.paddingRight=`${lockPaddingValue}px`,navigator.userAgent.includes("Chrome")&&(header.style.marginRight="-1px")),body.style.overflowY="hidden",0!=counterValue?(cart=cartTemplateFull.cloneNode(!0),cart.querySelector(".cart-popup__subtotal-sum").textContent=`${subtotalCart}$`):cart=cartTemplateEmpty.cloneNode(!0),main.append(cart),renderProducts();const t=document.querySelector(".cart-popup"),e=t.querySelector(".cart-popup__wrapper");if(mobile()){const o=t.querySelector(".cart-popup__close-btn");t.addEventListener("touchstart",(t=>{t.composedPath().includes(e)||closeCart()})),o.addEventListener("click",closeCart)}else{let t,o=cartContainer.offsetTop;t=window.innerHeight-cartContainer.offsetTop<=e.offsetHeight?window.innerWidth-cartContainer.offsetLeft-cartContainer.offsetWidth-lockPaddingValue:window.innerWidth-cartContainer.offsetLeft-cartContainer.offsetWidth,e.style=`margin-right:${t}px; margin-top:${o}px`}e.addEventListener("mouseleave",onContainerMouseLeave),t.classList.add("cart-popup--fade-out"),setTimeout((()=>t.classList.add("cart-popup--fade-out")),500)},reRenderCart=()=>{0==counterValue&&(cart.remove(),renderCart())},pickProducts=t=>{pickedProducts.push(t.target.name);let e=Array.from(new Set(pickedProducts));pickedProducts=e},renderProducts=()=>{0!==counterValue&&pickedProducts.forEach((t=>{const e=document.querySelector(".cart-popup__product-container"),o=document.createDocumentFragment(),r=productTemplate.cloneNode(!0);r.querySelector(".cart-popup__product-link").href=products[t].link,r.querySelector(".cart-popup__product-image").src=products[t].image,r.querySelector(".cart-popup__product-image").alt=products[t].title,r.querySelector(".cart-popup__product-name").textContent=products[t].title,r.querySelector(".cart-popup__product-price").textContent=`${products[t].sum}$`,r.querySelector(".cart-popup__product-quantity").textContent=`Quantity: ${products[t].quantity}`,r.querySelector(".cart-popup__product-remove").name=t,o.append(r),e.append(o);document.querySelectorAll(".cart-popup__product-remove").forEach((t=>{t.addEventListener("click",(()=>{t.parentElement.remove()})),t.addEventListener("click",onProductRemove)}))}))},countProducts=t=>{let e=products[t.target.name].quantity;subtotalQuantity=e+1,products[t.target.name].quantity=subtotalQuantity},calculateSubtotal=()=>{let t=[];pickedProducts.forEach((e=>{products[e].sum=products[e].quantity*products[e].price,subtotalSumProduct=products[e].sum,t.push(subtotalSumProduct)})),subtotalCart=t.reduce(((t,e)=>t+e))};cartButtons.forEach((t=>{t.addEventListener("click",onButtonClickAdd)})),cartContainer.addEventListener("mouseover",onContainerMouseEnter),cartContainer.addEventListener("touchstart",onContainerMouseEnter);